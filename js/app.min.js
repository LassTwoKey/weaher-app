(()=>{"use strict";function e(){const e=new Date;return`${["Январь","Февраль","Март","Апрель","Май","Июнь","Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь"][e.getMonth()]} ${e.getDate()}, ${t(e)}`}function t(e){"number"!=typeof e&&"string"!=typeof e||(e=new Date(e));const t=e.getHours(),n=e.getMinutes();return`${t}:${n<10?`0${n}`:n}`}function n(e,t){let n=new Date(1e3*e+1e3*t),a=n.getUTCHours(),o=n.getUTCMinutes();return`${a<10?`0${a}`:a}:${o<10?`0${o}`:o}`}function a(e){const t=[{min:0,max:22.5,text:"С"},{min:22.5,max:67.5,text:"СВ"},{min:67.5,max:112.5,text:"В"},{min:112.5,max:157.5,text:"ЮВ"},{min:157.5,max:202.5,text:"Ю"},{min:202.5,max:247.5,text:"ЮЗ"},{min:247.5,max:292.5,text:"З"},{min:292.5,max:337.5,text:"СЗ"},{min:337.5,max:360,text:"С"}];for(const n of t)if(e>=n.min&&e<n.max)return n.text;return"Неизвестное направление"}function o(e){const t=.75006*e;return Math.round(t)}function r(e){localStorage.setItem("currentUnit",e)}function i(){return localStorage.getItem("currentUnit")}const c={apiKey:"09d65a643b54838149fea98b67251c39",unit:i()??"metric",timezone:null,weatherInfo:{city:{geoFullName:null,name:null,lat:null,lot:null},widget:{feelsLike:null,temp:null,tempMax:null,tempMin:null,currentDate:null,main:null,description:null,iconUrl:null,backgroundUrl:null},main:{windSpeed:null,windDirection:null,clouds:null,pressure:null,humidity:null,sunrise:null,sunset:null},forecast:{list:[]}}};function s(){const e=document.getElementById("geo-full-name"),t=document.getElementById("main-temp"),n=document.getElementById("feels-like"),a=document.getElementById("weather-descr"),o=document.getElementById("current-date"),r=document.getElementById("max-temp"),i=document.getElementById("min-temp"),c=document.getElementById("widget-icon"),s=document.getElementById("background-url");e.innerHTML=appStore.weatherInfo.city.geoFullName,t.innerHTML=`${Math.round(appStore.weatherInfo.widget.temp)}°`,n.innerHTML=`Ощущается как ${Math.round(appStore.weatherInfo.widget.feelsLike)}°`,a.innerHTML=appStore.weatherInfo.widget.description,o.innerHTML=appStore.weatherInfo.widget.currentDate,r.innerHTML=`День ${Math.round(appStore.weatherInfo.widget.tempMax)}°`,i.innerHTML=`Ночь ${Math.round(appStore.weatherInfo.widget.tempMin)}°`,c.src=appStore.weatherInfo.widget.iconUrl,s.src=appStore.weatherInfo.widget.backgroundUrl;const l=document.getElementById("wind"),d=document.getElementById("clouds"),m=document.getElementById("pressure"),u=document.getElementById("humidity"),p=document.getElementById("sunrise"),h=document.getElementById("sunset");var f,w;l.innerHTML=(f=appStore.weatherInfo.main.windSpeed,w=appStore.weatherInfo.main.windDirection,`${f} ${"metric"===appStore.unit?"м/с":"м/ч"}, <span class="common-text">${w}</span>`),d.innerHTML=`${appStore.weatherInfo.main.clouds}%`,m.innerHTML=`${appStore.weatherInfo.main.pressure} мм рт. ст.`,u.innerHTML=`${appStore.weatherInfo.main.humidity}%`,p.innerHTML=appStore.weatherInfo.main.sunrise,h.innerHTML=appStore.weatherInfo.main.sunset,function(){const e=document.getElementById("today-forecast");e.innerHTML="",e&&appStore.weatherInfo.forecast.list.slice(0,8).forEach((t=>{e.appendChild(function(e){const t=document.createElement("div");return t.classList="swiper-slide hourly-forecast-items",t.innerHTML=`\n        <div class="hourly-forecast-item">\n        <h4>${e.time}</h4>\n        <img src="${e.iconUrl}" />\n        <p>${Math.round(e.temp)}°</p>\n        </div>\n    `,t}(t))}))}()}const l=async r=>{const c={lat:localStorage.getItem("lat")??55.7504461,lon:localStorage.getItem("lon")??37.6174943,name:localStorage.getItem("name")??"Moscow"},l={lat:r?.lat??c.lat,lon:r?.lon??c.lon,name:r?.name??c.name};!function({weatherByCity:r,ForecastByCoord:i}){var c;console.log({weatherByCity:r,ForecastByCoord:i}),appStore.timezone=r.timezone,appStore.weatherInfo.city.geoFullName=`${r.name}, ${r.sys.country}`,appStore.weatherInfo.city.name=r.name,appStore.weatherInfo.city.lat=r.coord.lat,appStore.weatherInfo.city.lot=r.coord.lot,appStore.weatherInfo.widget={feelsLike:r.main.feels_like,temp:r.main.temp,tempMax:r.main.temp_max,tempMin:r.main.temp_min,currentDate:e(),main:r.weather[0].main,description:(c=r.weather[0].description,c[0].toUpperCase()+c.slice(1)),iconUrl:`https://openweathermap.org/img/wn/${r.weather[0].icon}@2x.png`,backgroundUrl:`img/widget/${r.weather[0].main}.jpg`},appStore.weatherInfo.main={windSpeed:r.wind.speed,windDirection:a(r.wind.deg),clouds:r.clouds.all,pressure:o(r.main.pressure),humidity:r.main.humidity,sunrise:n(r.sys.sunrise,appStore.timezone),sunset:n(r.sys.sunset,appStore.timezone)},appStore.weatherInfo.forecast.list=i.list.map((e=>({time:t(e.dt_txt),iconUrl:`https://openweathermap.org/img/wn/${e.weather[0].icon}@2x.png`,temp:e.main.temp})))}({weatherByCity:await async function(e){const t=fetch(`https://api.openweathermap.org/data/2.5/weather?lang=ru&q=${e}&units=${appStore.unit}&appid=${appStore.apiKey}`);return(await t).json()}(l.name),ForecastByCoord:await async function(e,t){const n=fetch(`https://api.openweathermap.org/data/2.5/forecast?lang=ru&lat=${e}&lon=${t}&lang=ru&units=${appStore.unit}&appid=${appStore.apiKey}`);return(await n).json()}(l.lat,l.lon)}),s();const d=i(),m=document.querySelector(".degree"),u=document.querySelector(".fahrenheit");m&&"imperial"!==d&&m.classList.add("selected"),u&&"imperial"===d&&u.classList.add("selected")},d=document.querySelector(".degree"),m=document.querySelector(".fahrenheit");d.addEventListener("click",(e=>{"metric"!==i()&&(e.target===d&&m.classList.contains("selected")&&(d.classList.add("selected"),m.classList.remove("selected")),appStore.unit="metric",r("metric"),l())})),m.addEventListener("click",(e=>{"imperial"!==i()&&(e.target===m&&d.classList.contains("selected")&&(m.classList.add("selected"),d.classList.remove("selected")),appStore.unit="imperial",r("imperial"),l())})),new Swiper(".swiper",{slidesPerView:"auto",freeMode:!0,spaceBetween:15,breakpoints:{992:{spaceBetween:20}}});const u=document.querySelectorAll(".tabs-button"),p=document.querySelectorAll(".content-full-tabs");function h(){u.forEach((e=>{e.classList.remove("selected")})),p.forEach((e=>{e.classList.add("hide")}))}function f(e){u[e].classList.add("selected"),p[e].classList.remove("hide")}h(),f(0),u.forEach(((e,t)=>{e.addEventListener("click",(()=>{h(),f(t)}))}));const w=document.querySelectorAll(".five-days-content"),g=document.querySelectorAll(".five-days-open");function y(){w.forEach((e=>{e.classList.add("hide")})),g.forEach((e=>{e.classList.remove("active")}))}y(),g.forEach(((e,t)=>{e.addEventListener("click",(e=>{y(),function(e=0){w[e].classList.remove("hide"),g[e].classList.add("active")}(t)}))}));const S=document.querySelector(".search");function L(){document.querySelector(".header-search-input img").classList.remove("hide"),document.querySelector(".search-list").classList.add("hide"),document.querySelector(".close").classList.add("hide"),S.value=""}S.addEventListener("input",(e=>{document.querySelector(".header-search-input img").classList.add("hide"),document.querySelector(".search-list").classList.remove("hide"),document.querySelector(".close").classList.remove("hide"),""===event.target.value.trim()&&L()})),document.querySelector(".close").addEventListener("click",L),document.body.addEventListener("keydown",(e=>{"Escape"===e.key&&L()}));const I=function(e,t){let n;return function(){const t=this,a=arguments;clearTimeout(n),n=setTimeout((function(){e.apply(t,a)}),500)}}((function(){return async function(e){if(!e)return;const t=await async function(e){const t=await fetch(`http://api.openweathermap.org/geo/1.0/direct?q=${e}&limit=5&units=${appStore.unit}&appid=${appStore.apiKey}`);return(await t).json()}(e),n=document.querySelector(".search-list ul");if(0===t.length)return n.innerHTML=`По запросу "${e}" ничего не найдено`,[];const a=[];t.forEach((e=>{const t=e.local_names?.ru??e.name,n=e.country,o=document.createElement("li");o.innerHTML=`<button style="width: 100%;">${t}, ${n}</button>`,a.push(o)})),n.innerHTML="",a.forEach(((e,a)=>{n.appendChild(e),e.addEventListener("click",(async e=>{const n={lat:t[a].lat,lon:t[a].lon,name:t[a].name};var o;o=n,localStorage.setItem("lat",o.lat),localStorage.setItem("lon",o.lon),localStorage.setItem("name",o.name),await l(n),L()}))}))}(S.value.trim())}));document.querySelector(".search").addEventListener("input",I),window.appStore=c,l(),function(e){let t=new Image;t.onload=t.onerror=function(){!function(e){let t=!0===e?"webpY":"webpN";document.documentElement.classList.add(t)}(2==t.height)},t.src="data:image/webp;base64,UklGRjoAAABXRUJQVlA4IC4AAACyAgCdASoCAAIALmk0mk0iIiIiIgBoSygABc6WWgAA/veff/0PP8bA//LwYAAA"}()})();